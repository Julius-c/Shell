# 这是一个简化版的Linux Shell
## 所有命令参数都须以空格分开!

### 主要功能说明
1. 该project的可执行文件为`njush`，源代码全部在`shell.c`中，输入`make`即可运行`njush`。
2. 为保证该shell的正确性，每执行一条命令都与`/bin/bash`对照。
3. 等待输入时显示提示符`NJUSH:~$ `。
4. 输入`help`可查看内置命令的说明。
    + `exit`: 清理资源退出程序。
    + `cd [dir]`: 改变当前工作目录，默认有且只有一个参数。
    + `history [-c] [number]`: 简化的bash history命令。
    + `!!`: 执行最近一条命令。
    + `!String`: 执行历史命令中最近的以String开头的命令。
5. 支持多个(IO重定向)进程以及内置命令之间的管道。
    + 如`ls -l | grep njush | wc -l > junk`。
    + 如`sleep 10 | sleep 10 | sleep 10 > empty`。
    + 如`cd .. | history > a.txt | ls > b.txt`。
    + 如`!! > junk | !ls | less`。
6. 支持前台和后台进程正常工作。
    + 如`sleep 10 | sleep 10 | sleep 10 &`。
7. 使用gcc编译源码时使用`-Wall`显示所有警告。

### 代码思路说明
1. 一次读取命令执行过程如下。
    + 读取一行输入，单独处理`exit`。
    + 将`!!`和`!String`替换成相应命令。
    + 判断是否需要后台执行，改变flag，去掉`&`。
    + 处理完成将其插入链表。
    + 根据管道符`|`将一行命令拆分成多个命令及其参数，单独处理无管道内置命令。
    + 建立管道，fork进程分别执行，主进程等待。
2. 内置命令的实现相对容易。
    + 利用双向链表实现`history`。
    + 利用`chdir()`实现`cd`。
    + 利用字符串匹配、拼接实现`!!`和`!String`。
    + 归还链表内存空间实现`exit`。
    + 建立内置命令表以实现`help`和查找执行操作。
3. 管道多进程、IO重定向。
    + 用`redirect(argv[], index)`函数处理IO重定向。
    + 用`_if_built_in(token)`判断是否为内置命令。
        - 内置命令通过`cmd_table[id].handler(file)`执行，执行完毕立即退出该子进程。
        - 其他命令通过`execvp(file, argv[])`执行。
    + 用`execute(args)`处理管道。
        - 分为首管道、中间管道、终管道三类处理。
        - 每类中内置命令单独处理。

### 有待改进说明
1. 用于测试的命令有限。
2. 处理后台进程时会产生僵尸进程。
